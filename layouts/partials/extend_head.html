{{- if or .Params.math .Site.Params.math }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '\\[', right: '\\]', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false}
        ],
        throwOnError: false
    });"></script>
{{- end }}

<style>
/* Fix code block overflow */
.post-content .highlight pre {
    overflow-x: auto;
}
.post-content .highlight pre code {
    display: block;
    white-space: pre;
}

/* Copy button */
.highlight {
    position: relative;
}
.copy-button {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    font-size: 12px;
    background: var(--code-bg, #2d2d2d);
    border: 1px solid var(--border, #444);
    border-radius: 4px;
    color: var(--secondary, #888);
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s;
}
.highlight:hover .copy-button {
    opacity: 1;
}
.copy-button:hover {
    background: var(--tertiary, #444);
    color: var(--primary, #fff);
}
.copy-button.copied {
    color: #4ade80;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.highlight').forEach(function(block) {
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.addEventListener('click', function() {
            const code = block.querySelector('code');
            const text = code.innerText;
            navigator.clipboard.writeText(text).then(function() {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                setTimeout(function() {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            });
        });
        block.appendChild(button);
    });
});
</script>
